{"version":3,"file":"vuejs-storage.min.js","sources":["../src/lsstorage.ts","../src/objpath.ts","../node_modules/object-assign/index.js","../src/index.ts","../src/vuexplugin.ts","../src/install.ts"],"sourcesContent":["import { Option, lsStorage } from './interfaces'\n\n/**\n * Create customize localStorage\n */\nexport function createLSStorage({\n\tstorage = window.localStorage,\n\tstringify = JSON.stringify,\n\tparse = JSON.parse,\n\tnamespace\n}: Option): lsStorage {\n\treturn {\n\t\tset(value) {\n\t\t\tstorage.setItem(namespace, stringify(value))\n\t\t},\n\t\tget() {\n\t\t\treturn parse(storage.getItem(namespace))\n\t\t},\n\t\texists() {\n\t\t\treturn storage.getItem(namespace) != null\n\t\t}\n\t}\n}\n","export function get(obj: object, path: string): any {\n\treturn path\n\t\t.replace(/\\[([^[\\]]*)\\]/g, '.$1.')\n\t\t.split('.')\n\t\t.filter(t => t !== '')\n\t\t.reduce((prev, cur) => prev && prev[cur], obj)\n}\nexport function set(obj: object, path: string, value: any): void {\n\tconst paths = path\n\t\t.replace(/\\[([^[\\]]*)\\]/g, '.$1.')\n\t\t.split('.')\n\t\t.filter(t => t !== '')\n\tlet cur = obj\n\tfor (let i = 0; i < paths.length - 1; i++) {\n\t\tconst pname = paths[i]\n\t\tif (!cur.hasOwnProperty(pname)) cur[pname] = {}\n\t\tcur = cur[pname]\n\t}\n\tcur[paths[paths.length - 1]] = value\n}\nexport function copy(dest: object, source: object, path: string): void {\n\tset(dest, path, get(source, path))\n}\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","import { Vue, VueConstructor, VuexPlugin } from './interfaces'\n\nimport { install } from './install'\nimport { createVuexPlugin } from './vuexplugin'\nimport { createLSStorage } from './lsstorage'\n\ninterface vjs {\n\t(): VuexPlugin<Object>\n\tinstall: (Vue: VueConstructor) => any\n}\nconst vuejsStorage = <vjs>function(option) {\n\treturn createVuexPlugin(option)\n}\nvuejsStorage.install = install\n\nexport default vuejsStorage\n","import { Store, VuexPlugin, Option } from './interfaces'\nimport { copy } from './objpath'\nimport { createLSStorage } from './lsstorage'\n\nimport assign from 'object-assign'\n\n/**\n * Create Vuex plugin\n */\nexport function createVuexPlugin(option: Option): VuexPlugin<Object> {\n\tconst ls = createLSStorage(option)\n\tconst { keys, merge } = option\n\treturn (store: Store<Object>) => {\n\t\tlet data = null\n\t\tif (ls.exists()) {\n\t\t\tdata = ls.get()\n\t\t} else {\n\t\t\tconst tmp = {}\n\t\t\tfor (const k of keys) {\n\t\t\t\tcopy(tmp, store.state, k)\n\t\t\t}\n\t\t\tdata = tmp\n\t\t\tls.set(data)\n\t\t}\n\t\tstore.replaceState(merge ? merge(store.state, data) : assign(store.state, data)) //merge state\n\t\tstore.subscribe((mutation, state) => {\n\t\t\tconst obj = {}\n\t\t\tkeys.forEach(k => copy(obj, state, k))\n\t\t\tls.set(obj)\n\t\t})\n\t}\n}\n","import { VueConstructor, Option } from './interfaces'\nimport { createLSStorage } from './lsstorage'\nimport { set, copy } from './objpath'\n\nimport assign from 'object-assign'\n\nexport function install(Vue: VueConstructor) {\n\tVue.mixin({\n\t\tcreated() {\n\t\t\tif ('storage' in this.$options) {\n\t\t\t\tconst option: Option = this.$options.storage\n\t\t\t\tconst { keys, merge } = option\n\n\t\t\t\tconst ls = createLSStorage(option)\n\n\t\t\t\tlet optdata = {}\n\t\t\t\tfor (const k of keys) {\n\t\t\t\t\tcopy(optdata, this, k)\n\t\t\t\t}\n\n\t\t\t\tlet data = null\n\t\t\t\tif (ls.exists()) {\n\t\t\t\t\tdata = ls.get()\n\t\t\t\t} else {\n\t\t\t\t\tconst tmp = {}\n\t\t\t\t\tfor (const k of keys) {\n\t\t\t\t\t\tcopy(tmp, optdata, k)\n\t\t\t\t\t}\n\t\t\t\t\tdata = tmp\n\t\t\t\t\tls.set(data)\n\t\t\t\t}\n\t\t\t\tdata = merge ? merge(optdata, data) : assign(optdata, data)\n\n\t\t\t\tfor (const k of keys) {\n\t\t\t\t\tcopy(this, data, k)\n\t\t\t\t\tthis.$watch(k, value => {\n\t\t\t\t\t\tset(data, k, value)\n\t\t\t\t\t\tls.set(data)\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n}\n"],"names":["_a","_b","storage","_c","stringify","_d","parse","namespace","set","value","setItem","get","getItem","exists","obj","path","paths","replace","split","filter","t","cur","i","length","pname","hasOwnProperty","dest","source","reduce","prev","getOwnPropertySymbols","Object","prototype","propIsEnumerable","propertyIsEnumerable","assign","test1","String","getOwnPropertyNames","test2","fromCharCode","map","n","join","test3","forEach","letter","keys","err","shouldUseNative","target","from","symbols","to","val","undefined","TypeError","toObject","s","arguments","key","call","vuejsStorage","option","ls","createLSStorage","merge","store","data","tmp","keys_1","_i","k","copy","state","replaceState","subscribe","mutation","createVuexPlugin","install","Vue","mixin","created","this","$options","ls_1","optdata","data_1","keys_2","this_1","$watch","keys_3"],"mappings":"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"}