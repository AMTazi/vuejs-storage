{"version":3,"file":"vuejs-storage.min.js","sources":["../src/lsstorage.ts","../src/objpath.ts","../src/assign.ts","../src/index.ts","../src/vuexplugin.ts","../src/install.ts"],"sourcesContent":["import { Option, lsStorage } from './interfaces'\n\n/**\n * Create customize localStorage\n */\nexport function createLSStorage({\n\tstorage = window.localStorage,\n\tstringify = JSON.stringify,\n\tparse = JSON.parse,\n\tnamespace\n}: Option): lsStorage {\n\treturn {\n\t\tset(value) {\n\t\t\tstorage.setItem(namespace, stringify(value))\n\t\t},\n\t\tget() {\n\t\t\treturn parse(storage.getItem(namespace))\n\t\t},\n\t\texists() {\n\t\t\treturn storage.getItem(namespace) != null\n\t\t}\n\t}\n}\n","export function parsePath(path: string): string[] {\n\treturn path\n\t\t.replace(/\\[([^[\\]]*)\\]/g, '.$1.')\n\t\t.split('.')\n\t\t.filter(t => t !== '')\n}\nexport function get(obj: object, path: string): any {\n\treturn parsePath(path).reduce((prev, cur) => prev && prev[cur], obj)\n}\nexport function set(obj: object, path: string, value: any): void {\n\tconst paths = parsePath(path)\n\tlet cur = obj\n\tfor (let i = 0; i < paths.length - 1; i++) {\n\t\tconst pname = paths[i]\n\t\tif (!cur.hasOwnProperty(pname)) cur[pname] = {}\n\t\tcur = cur[pname]\n\t}\n\tcur[paths[paths.length - 1]] = value\n}\nexport function copy(dest: object, source: object, path: string): void {\n\tset(dest, path, get(source, path))\n}\n","// a simple object merge function implementation\nexport default function(obj1, ...objs) {\n\tfor (const obj2 of objs) {\n\t\tfor (const k in obj2) {\n\t\t\tif (!obj2.hasOwnProperty(k)) continue\n\t\t\tobj1[k] = obj2[k]\n\t\t}\n\t}\n\treturn obj1\n}\n","import { Vue, VueConstructor, VuexPlugin } from './interfaces'\n\nimport { install } from './install'\nimport { createVuexPlugin } from './vuexplugin'\nimport { createLSStorage } from './lsstorage'\n\ninterface vjs {\n\t(): VuexPlugin<Object>\n\tinstall: (Vue: VueConstructor) => any\n}\nconst vuejsStorage = <vjs>function(option) {\n\treturn createVuexPlugin(option)\n}\nvuejsStorage.install = install\n\nexport default vuejsStorage\n","import { Store, VuexPlugin, Option } from './interfaces'\nimport { copy } from './objpath'\nimport { createLSStorage } from './lsstorage'\n\nimport assign from './assign'\n\n/**\n * Create Vuex plugin\n */\nexport function createVuexPlugin(option: Option): VuexPlugin<Object> {\n\tconst ls = createLSStorage(option)\n\tconst { keys, merge } = option\n\treturn (store: Store<Object>) => {\n\t\tlet data = null\n\t\tif (ls.exists()) {\n\t\t\tdata = ls.get()\n\t\t} else {\n\t\t\tconst tmp = {}\n\t\t\tfor (const k of keys) {\n\t\t\t\tcopy(tmp, store.state, k)\n\t\t\t}\n\t\t\tdata = tmp\n\t\t\tls.set(data)\n\t\t}\n\t\tstore.replaceState(merge ? merge(store.state, data) : assign(store.state, data)) //merge state\n\t\tstore.subscribe((mutation, state) => {\n\t\t\tconst obj = {}\n\t\t\tkeys.forEach(k => copy(obj, state, k))\n\t\t\tls.set(obj)\n\t\t})\n\t}\n}\n","import { VueConstructor, Option } from './interfaces'\nimport { createLSStorage } from './lsstorage'\nimport { set, copy } from './objpath'\n\nimport assign from './assign'\n\nexport function install(Vue: VueConstructor) {\n\tVue.mixin({\n\t\tcreated() {\n\t\t\tif ('storage' in this.$options) {\n\t\t\t\tconst option: Option = this.$options.storage\n\t\t\t\tconst { keys, merge } = option\n\n\t\t\t\tconst ls = createLSStorage(option)\n\n\t\t\t\tlet optdata = {}\n\t\t\t\tfor (const k of keys) {\n\t\t\t\t\tcopy(optdata, this, k)\n\t\t\t\t}\n\n\t\t\t\tlet data = null\n\t\t\t\tif (ls.exists()) {\n\t\t\t\t\tdata = ls.get()\n\t\t\t\t} else {\n\t\t\t\t\tconst tmp = {}\n\t\t\t\t\tfor (const k of keys) {\n\t\t\t\t\t\tcopy(tmp, optdata, k)\n\t\t\t\t\t}\n\t\t\t\t\tdata = tmp\n\t\t\t\t\tls.set(data)\n\t\t\t\t}\n\t\t\t\tdata = merge ? merge(optdata, data) : assign(optdata, data)\n\n\t\t\t\tfor (const k of keys) {\n\t\t\t\t\tcopy(this, data, k)\n\t\t\t\t\tthis.$watch(k, value => {\n\t\t\t\t\t\tset(data, k, value)\n\t\t\t\t\t\tls.set(data)\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n}\n"],"names":["_a","_b","storage","_c","stringify","_d","parse","namespace","set","value","setItem","get","getItem","exists","path","replace","split","filter","t","obj","paths","parsePath","cur","i","length","pname","hasOwnProperty","dest","source","reduce","prev","obj1","_i","objs","objs_1","obj2","k","vuejsStorage","option","ls","createLSStorage","keys","merge","store","data","tmp","keys_1","copy","state","replaceState","assign","subscribe","mutation","forEach","createVuexPlugin","install","Vue","mixin","created","this","$options","ls_1","optdata","data_1","keys_2","this_1","$watch","keys_3"],"mappings":"mMAKgCA,OAC/BC,YAAAC,mCACAC,cAAAC,8BACAC,UAAAC,0BACAC,cAEA,OACCC,aAAIC,GACHP,EAAQQ,QAAQH,EAAWH,EAAUK,KAEtCE,eACC,OAAOL,EAAMJ,EAAQU,QAAQL,KAE9BM,kBACC,OAAqC,MAA9BX,EAAQU,QAAQL,gBCnBAO,GACzB,OAAOA,EACLC,QAAQ,iBAAkB,QAC1BC,MAAM,KACNC,OAAO,SAAAC,GAAK,MAAM,KAANA,eAKKC,EAAaL,EAAcL,GAG9C,IAFA,IAAMW,EAAQC,EAAUP,GACpBQ,EAAMH,EACDI,EAAI,EAAGA,EAAIH,EAAMI,OAAS,EAAGD,IAAK,CAC1C,IAAME,EAAQL,EAAMG,GACfD,EAAII,eAAeD,KAAQH,EAAIG,OACpCH,EAAMA,EAAIG,GAEXH,EAAIF,EAAMA,EAAMI,OAAS,IAAMf,aAEXkB,EAAcC,EAAgBd,GAClDN,EAAImB,EAAMb,WAdSK,EAAaL,GAChC,OAAOO,EAAUP,GAAMe,OAAO,SAACC,EAAMR,GAAQ,OAAAQ,GAAQA,EAAKR,IAAMH,GAahDR,CAAIiB,EAAQd,eCnBLiB,OAAM,aAAAC,mBAAAA,IAAAC,oBAC7B,IAAmB,QAAAC,IAAAlC,WAAAA,KAAd,IAAMmC,OACV,IAAK,IAAMC,KAAKD,EACVA,EAAKT,eAAeU,KACzBL,EAAKK,GAAKD,EAAKC,IAGjB,OAAOL,ECER,IAAMM,EAAoB,SAASC,GAClC,gBCFgCA,GAChC,IAAMC,EAAKC,EAAgBF,GACnBG,SAAMC,UACd,OAAO,SAACC,GACP,IAAIC,EAAO,KACX,GAAIL,EAAG1B,SACN+B,EAAOL,EAAG5B,UACJ,CAEN,IADA,IAAMkC,SACUC,IAAAd,WAAAA,KAAX,IAAMI,OACVW,EAAKF,EAAKF,EAAMK,MAAOZ,GAExBQ,EAAOC,EACPN,EAAG/B,IAAIoC,GAERD,EAAMM,aAAaP,EAAQA,EAAMC,EAAMK,MAAOJ,GAAQM,EAAOP,EAAMK,MAAOJ,IAC1ED,EAAMQ,UAAU,SAACC,EAAUJ,GAC1B,IAAM7B,KACNsB,EAAKY,QAAQ,SAAAjB,GAAK,OAAAW,EAAK5B,EAAK6B,EAAOZ,KACnCG,EAAG/B,IAAIW,MDjBFmC,CAAiBhB,WAEzBD,EAAakB,iBEPWC,GACvBA,EAAIC,OACHC,mBACC,GAAI,YAAaC,KAAKC,SAAU,CAO/B,IANA,IAAMtB,EAAiBqB,KAAKC,SAAS1D,QAC7BuC,SAAMC,UAERmB,EAAKrB,EAAgBF,GAEvBwB,SACYhB,IAAAd,WAAAA,IACfe,EAAKe,EAASH,WAGf,IAAII,EAAO,KACX,GAAIF,EAAGhD,SACNkD,EAAOF,EAAGlD,UACJ,CAEN,IADA,IAAMkC,SACUmB,IAAAhE,WAAAA,IACf+C,EAAKF,EAAKiB,QAEXC,EAAOlB,EACPgB,EAAGrD,IAAIuD,GAERA,EAAOrB,EAAQA,EAAMoB,EAASC,GAAQb,EAAOY,EAASC,GAEtD,mBAAW3B,GACVW,IAAWgB,EAAM3B,GACjB6B,EAAKC,OAAO9B,EAAG,SAAA3B,GACdD,EAAIuD,EAAM3B,EAAG3B,GACboD,EAAGrD,IAAIuD,iBAJOI,IAAAlE,WAAAA"}