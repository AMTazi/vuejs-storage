{"version":3,"file":"vuejs-storage.min.js","sources":["../src/lsstorage.ts","../src/objpath.ts","../node_modules/object-assign/index.js","../src/index.ts","../src/vuexplugin.ts","../src/install.ts"],"sourcesContent":["import { Option, lsStorage } from './interfaces'\n\n/**\n * Create customize localStorage\n */\nexport function createLSStorage({\n\tstorage = window.localStorage,\n\tstringify = JSON.stringify,\n\tparse = JSON.parse,\n\tnamespace\n}: Option): lsStorage {\n\treturn {\n\t\tset(value) {\n\t\t\tstorage.setItem(namespace, stringify(value))\n\t\t},\n\t\tget() {\n\t\t\treturn parse(storage.getItem(namespace))\n\t\t},\n\t\texists() {\n\t\t\treturn storage.getItem(namespace) != null\n\t\t}\n\t}\n}\n","export function get(obj: object, path: string): any {\n\treturn path\n\t\t.replace(/\\[([^[\\]]*)\\]/g, '.$1.')\n\t\t.split('.')\n\t\t.filter(t => t !== '')\n\t\t.reduce((prev, cur) => prev && prev[cur], obj)\n}\nexport function set(obj: object, path: string, value: any): void {\n\tconst paths = path\n\t\t.replace(/\\[([^[\\]]*)\\]/g, '.$1.')\n\t\t.split('.')\n\t\t.filter(t => t !== '')\n\tfunction _set(paths, cur) {\n\t\tconst pname = paths.shift()\n\t\tif (paths.length === 0) {\n\t\t\tcur[pname] = value\n\t\t} else {\n\t\t\tif (!cur.hasOwnProperty(pname)) cur[pname] = {}\n\t\t\t_set(paths, cur[pname])\n\t\t}\n\t}\n\t_set(paths, obj)\n}\nexport function copy(dest: object, source: object, path: string): void {\n\tset(dest, path, get(source, path))\n}\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","import { Vue, VueConstructor, VuexPlugin } from './interfaces'\n\nimport { install } from './install'\nimport { createVuexPlugin } from './vuexplugin'\nimport { createLSStorage } from './lsstorage'\n\ninterface vjs {\n\t(): VuexPlugin<Object>\n\tinstall: (Vue: VueConstructor) => any\n}\nconst vuejsStorage = <vjs>function(option) {\n\treturn createVuexPlugin(option)\n}\nvuejsStorage.install = install\n\ndeclare var module: {\n\texports: {}\n}\nmodule.exports = vuejsStorage\n","import { Store, VuexPlugin, Option } from './interfaces'\nimport { copy } from './objpath'\nimport { createLSStorage } from './lsstorage'\n\nimport assign from 'object-assign'\n\n/**\n * Create Vuex plugin\n */\nexport function createVuexPlugin(option: Option): VuexPlugin<Object> {\n\tconst ls = createLSStorage(option)\n\tconst { keys, merge } = option\n\treturn (store: Store<Object>) => {\n\t\tlet data = null\n\t\tif (ls.exists()) {\n\t\t\tdata = ls.get()\n\t\t} else {\n\t\t\tconst tmp = {}\n\t\t\tfor (const k of keys) {\n\t\t\t\tcopy(tmp, store.state, k)\n\t\t\t}\n\t\t\tdata = tmp\n\t\t\tls.set(data)\n\t\t}\n\t\tstore.replaceState(merge ? merge(store.state, data) : assign(store.state, data)) //merge state\n\t\tstore.subscribe((mutation, state) => {\n\t\t\tconst obj = {}\n\t\t\tkeys.forEach(k => copy(obj, state, k))\n\t\t\tls.set(obj)\n\t\t})\n\t}\n}\n","import { VueConstructor, Option } from './interfaces'\nimport { createLSStorage } from './lsstorage'\nimport { set, copy } from './objpath'\n\nimport assign from 'object-assign'\n\nexport function install(Vue: VueConstructor) {\n\tVue.mixin({\n\t\tcreated() {\n\t\t\tif ('storage' in this.$options) {\n\t\t\t\tconst option: Option = this.$options.storage\n\t\t\t\tconst { keys, merge } = option\n\n\t\t\t\tconst ls = createLSStorage(option)\n\n\t\t\t\tlet optdata = {}\n\t\t\t\tfor (const k of keys) {\n\t\t\t\t\tcopy(optdata, this, k)\n\t\t\t\t}\n\n\t\t\t\tlet data = null\n\t\t\t\tif (ls.exists()) {\n\t\t\t\t\tdata = ls.get()\n\t\t\t\t} else {\n\t\t\t\t\tconst tmp = {}\n\t\t\t\t\tfor (const k of keys) {\n\t\t\t\t\t\tcopy(tmp, optdata, k)\n\t\t\t\t\t}\n\t\t\t\t\tdata = tmp\n\t\t\t\t\tls.set(data)\n\t\t\t\t}\n\t\t\t\tdata = merge ? merge(optdata, data) : assign(optdata, data)\n\n\t\t\t\tfor (const k of keys) {\n\t\t\t\t\tcopy(this, data, k)\n\t\t\t\t\tthis.$watch(k, value => {\n\t\t\t\t\t\tset(data, k, value)\n\t\t\t\t\t\tls.set(data)\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n}\n"],"names":["_a","_b","storage","_c","stringify","_d","parse","namespace","set","value","setItem","get","getItem","exists","obj","path","paths","cur","pname","shift","length","hasOwnProperty","_set","replace","split","filter","t","dest","source","reduce","prev","getOwnPropertySymbols","Object","prototype","propIsEnumerable","propertyIsEnumerable","assign","test1","String","getOwnPropertyNames","test2","i","fromCharCode","map","n","join","test3","forEach","letter","keys","err","shouldUseNative","target","from","symbols","to","val","undefined","TypeError","toObject","s","arguments","key","call","vuejsStorage","option","ls","createLSStorage","merge","store","data","tmp","keys_1","_i","k","copy","state","replaceState","subscribe","mutation","createVuexPlugin","install","Vue","mixin","created","this","$options","ls_1","optdata","data_1","keys_2","this_1","$watch","keys_3","module","exports"],"mappings":"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"}